<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <style>
      body {
        font-family: monospace;
        font-size: xx-large;
      }
      input {
        font-family: inherit; font-size: inherit; background-color: inherit; color: inherit;
        width: 99%;
      }
      @media (prefers-color-scheme: dark) {
        body {
          background-color: #222;
          color: white;
          white-space: nowrap;
          overflow-x: auto;
        }
      }
    </style>
    <title>Abakus calculator</title>  
  </head>
  <body>
    <input type='number' id='numbers1' placeholder='123412'>
    <div id='score1'></div>
    <input type='number' id='numbers2' placeholder='221'>
    <div id='score2'></div>
    <input type='number' id='numbers3' placeholder='331'>
    <div id='score3'></div>
    <input type='number' id='numbers4' placeholder='441'>
    <div id='score4'></div>
    <script>
document.getElementById('numbers1').addEventListener('input', e => update(e.target.value,'score1'));      
document.getElementById('numbers2').addEventListener('input', e => update(e.target.value,'score2'));      
document.getElementById('numbers3').addEventListener('input', e => update(e.target.value,'score3'));      
document.getElementById('numbers4').addEventListener('input', e => update(e.target.value,'score4'));      

      
function update(numbers,scoreid){  
  var ab = abakus(numbers);
  console.log(ab);
  document.getElementById(scoreid).innerText = 
    numbers.replace(/[0-9](?=[0-9])/g,x=>x+' ')+' : '+ab.reduce((s,x)=>x.sum+s,0)+'\n'+
    ab.map(x=>x.eq+' : '+x.sum+'\n').join('')
    ;
}

function abakus(str) {
  var ops = [
    {o:'+',f:(a,b)=>a+b},
    {o:'-',f:(a,b)=>a-b},
    {o:'\u00D7',f:(a,b)=>a*b},
    {o:'\u00F7',f:(a,b)=>a/b},
  ];
  var a = [{str:str}]
    // all substrings begin
    .flatMap(s=>
      [...Array(s.str.length-1)].map((_,x)=>({...s, before:x, str:s.str.slice(x)}))
    )
    // all substrings end
    .flatMap(s=>
      [...Array(s.str.length-1)].map((_,x)=>({...s, after:s.str.length-x-1-1, str:s.str.slice(0,x+1+1)}))
    )
    // all splits a|bb
    .flatMap(s=>
      [...Array(s.str.length-1)].map((_,x)=>({...s, a:s.str.slice(0,x+1), b:s.str.slice(x+1)}))
    )
    // all splits a|b|c
    .flatMap(s=>
      [...Array(s.b.length-1)].map((_,x)=>({...s, b:s.b.slice(0,x+1), c:s.b.slice(x+1)}))
    )
    // remove '0' or leading '0...'
    .filter(s=> [s.a,s.b,s.c].every(x=>!x.startsWith('0')) )    
    // apply operators
    .flatMap(s=>
      ops
        // only valid op results
        .filter(o=> o.f(+s.a,+s.b)===+s.c )
        //.slice(0,1) // only valid first op
        .map(o=> ({...s,
          op: o,
          eq: ([...Array(s.before)].map(x=>'.').join('') + s.a+o.o+s.b+'='+s.c +[...Array(s.after)].map(x=>'.').join('')).replace(/[0-9.](?=[0-9.])/g,x=>x+' '),
          sum: (s.a+s.b+s.c).split('').reduce((s,x)=>+x+s,0)
        }) )
    )
  ;
  // one substring counts only once, filter out additional valid equations on same substrings
  var aa = Object.values(a.reduce((d,x)=>(d[x.before+'_'+x.after]||=x,d),{}));
  //var aa = [...(new Map(a.map(x => [x.before+'.'+x.after, x]))).values()];
  return aa;
}  
update('123412','score1');
    </script>
  </body>
</html>
